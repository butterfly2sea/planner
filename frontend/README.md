# 稻城亚丁旅游规划系统 - 前端

基于原生JavaScript和现代构建工具的单页应用，提供直观的旅游规划界面。

## 功能特性

- 🔐 **用户认证** - 登录/注册/退出
- 📍 **地图视图** - 多种地图样式切换（街道、卫星、地形、深色）
- 📅 **时间轴** - 按日期展示行程安排
- 📊 **甘特图** - 可视化时间关系，支持拖拽调整
- ✏️ **元素管理** - 完整的CRUD操作
- 🔗 **关联设置** - 元素间的依赖关系管理
- 📷 **图片上传** - 支持拖拽上传
- 📥 **数据导出** - JSON格式导出

## 技术栈

- **构建工具**: Rollup
- **地图库**: MapLibre GL JS
- **甘特图**: Frappe Gantt
- **日期处理**: Day.js
- **拖拽排序**: SortableJS
- **样式**: 原生CSS with CSS Variables

## 目录结构

```
frontend/
├── src/
│   ├── api/              # API服务
│   │   └── index.js      # API客户端
│   ├── services/         # 业务服务
│   │   ├── authService.js
│   │   ├── planService.js
│   │   └── itemService.js
│   ├── components/       # UI组件
│   │   ├── map.js        # 地图组件
│   │   ├── timeline.js   # 时间轴组件
│   │   ├── gantt.js      # 甘特图组件
│   │   └── itemForm.js   # 表单组件
│   ├── utils/            # 工具函数
│   │   └── toast.js      # 提示工具
│   ├── styles/           # 样式文件
│   │   └── main.css      # 主样式
│   ├── index.html        # HTML入口
│   └── main.js           # JS入口
├── dist/                 # 构建输出
├── package.json          # 项目配置
├── rollup.config.js      # Rollup配置
└── README.md            # 说明文档
```

## 安装依赖

```bash
cd frontend
npm install
```

## 开发模式

```bash
npm run dev
```

启动开发服务器，默认端口 3001，支持热重载。

## 生产构建

```bash
npm run build
```

构建文件将输出到 `dist` 目录。

## 部署

### 方式1：独立部署

```bash
npm run build
npm run serve
```

### 方式2：与后端集成

将 `dist` 目录中的文件复制到后端的 `static` 目录：

```bash
npm run build
cp -r dist/* ../static/
```

## 配置说明

### API地址配置

编辑 `src/api/index.js` 中的 `API_BASE_URL`：

```javascript
const API_BASE_URL = 'http://localhost:3000/api/v1';
```

### 地图配置

在 `src/components/map.js` 中可以配置不同的地图样式和图层。

## 主要功能使用说明

### 1. 用户认证

- 首次使用需要注册账号
- 登录后token保存在localStorage
- 退出登录会清除本地存储

### 2. 计划管理

- 创建新计划：点击"新建"按钮
- 选择计划：从下拉列表选择
- 计划会自动保存到后端

### 3. 元素管理

- **添加元素**：点击"添加"按钮，填写必填项
- **编辑元素**：点击元素卡片上的编辑按钮
- **删除元素**：点击元素卡片上的删除按钮
- **类型过滤**：点击顶部的类型标签

### 4. 地图功能

- **切换样式**：选择不同的地图图层
- **点击定位**：在添加元素时点击地图自动填充坐标
- **适应视图**：自动调整地图显示所有元素

### 5. 时间轴

- 按日期分组显示行程
- 点击元素查看详情
- 快速编辑功能

### 6. 甘特图

- **拖拽调整**：拖动任务条调整时间
- **缩放视图**：使用缩放按钮调整显示粒度
- **依赖关系**：自动显示元素间的依赖线

### 7. 关联设置

- 在编辑元素时设置关联
- 支持多种关联类型：
    - 附近（near_to）
    - 需要（requires）
    - 冲突（conflicts_with）
    - 替代（alternative_to）
    - 包含于（included_in）

### 8. 图片管理

- 支持拖拽上传
- 支持多图片上传
- 自动清理之前的上传记录

## 问题修复说明

### 已解决的问题

1. ✅ **数据持久化** - 所有修改自动保存到后端数据库
2. ✅ **元素编辑** - 支持编辑已有的旅游元素
3. ✅ **关联设置** - 自动加载可关联的元素列表
4. ✅ **地图图层** - 支持4种地图样式切换
5. ✅ **表单验证** - 必填项验证和时间逻辑验证
6. ✅ **图片清理** - 每次打开表单自动清理上传记录
7. ✅ **界面优化** - 移除不必要的统计卡片和标签
8. ✅ **甘特图** - 新增甘特图视图，支持拖拽调整
9. ✅ **约束检查** - 检查"需要"类型的关联约束
10. ✅ **代码组织** - 模块化代码结构，使用Rollup打包

## 浏览器兼容性

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 开发建议

1. **调试模式**：开发时打开浏览器控制台查看API请求
2. **网络检查**：使用Network面板监控请求响应
3. **本地存储**：使用Application面板查看localStorage

## 常见问题

### Q: 地图不显示？
A: 检查网络连接，确保能访问地图瓦片服务器。

### Q: 无法登录？
A: 确保后端服务正常运行，检查API地址配置。

### Q: 甘特图不显示？
A: 需要元素设置了开始和结束时间才会显示。

### Q: 图片上传失败？
A: 检查文件大小限制（5MB）和格式要求。

## 许可证

MIT License